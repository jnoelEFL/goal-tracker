<!DOCTYPE html><html lang="en"><head><title>history/HistoryScreen</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="history/HistoryScreen"><meta name="groc-project-path" content="src/history/HistoryScreen.js"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path">src/history/HistoryScreen.js</div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><h1 id="historique-conteneur">Historique (conteneur)</h1></div></div></div><div class="segment"><div class="code"><div class="wrapper"><span class="hljs-keyword">import</span> PropTypes <span class="hljs-keyword">from</span> <span class="hljs-string">'prop-types'</span>
<span class="hljs-keyword">import</span> React, { Component } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>
<span class="hljs-keyword">import</span> DocumentTitle <span class="hljs-keyword">from</span> <span class="hljs-string">'react-document-title'</span>
<span class="hljs-keyword">import</span> { connect } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-redux'</span>
<span class="hljs-keyword">import</span> { Link } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-router-dom'</span>

<span class="hljs-keyword">import</span> { Card, CardActions, CardText, CardTitle } <span class="hljs-keyword">from</span> <span class="hljs-string">'material-ui/Card'</span>
<span class="hljs-keyword">import</span> FlatButton <span class="hljs-keyword">from</span> <span class="hljs-string">'material-ui/FlatButton'</span>
<span class="hljs-keyword">import</span> RaisedButton <span class="hljs-keyword">from</span> <span class="hljs-string">'material-ui/RaisedButton'</span>
<span class="hljs-keyword">import</span> ClearIcon <span class="hljs-keyword">from</span> <span class="hljs-string">'material-ui/svg-icons/content/clear'</span>
<span class="hljs-keyword">import</span> ArrowBack <span class="hljs-keyword">from</span> <span class="hljs-string">'material-ui/svg-icons/navigation/arrow-back'</span>

<span class="hljs-keyword">import</span> { clearHistory } <span class="hljs-keyword">from</span> <span class="hljs-string">'../reducers/history'</span>
<span class="hljs-keyword">import</span> { GoalPropType, HistoryDayStatsPropType } <span class="hljs-keyword">from</span> <span class="hljs-string">'../shared/prop-types'</span>
<span class="hljs-keyword">import</span> HistoryDay <span class="hljs-keyword">from</span> <span class="hljs-string">'./HistoryDay'</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h2 id="le-composant-conteneur">Le composant conteneur</h2></div></div></div><div class="segment"><div class="code"><div class="wrapper"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HistoryScreen</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span> </span>{
  static propTypes = {
    dispatch: PropTypes.func.isRequired,
    goals: PropTypes.arrayOf(GoalPropType).isRequired,
    history: PropTypes.arrayOf(HistoryDayStatsPropType).isRequired,
  }

  render() {</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Déstructuration des <code>props</code> pour bénéficier d’identifiants courts</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-keyword">const</span> { goals, history, dispatch } = <span class="hljs-keyword">this</span>.props
    <span class="hljs-keyword">return</span> (</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Enrobage par un
<a href="https://github.com/gaearon/react-document-title"><code>&lt;DocumentTitle&gt;</code></a>
pour modifier automatiquement le titre de la fenêtre lorsqu’on affiche
ce composant conteneur.</p>
<p>Quand on fait un bouton destiné à être en fait un lien, surtout au
sein d’un <a href="https://github.com/reactjs/react-router-
tutorial/blob/start/lessons/03-navigating-with-link.md"><code>&lt;Link&gt;</code></a>, on utilise
la propriété <a href="http://www.material-ui.com/#/components
/raised-button"><code>linkButton</code></a> et on enrobe grâce à
<a href="https://github.com/callemall/material-
ui/issues/850"><code>containerElement</code></a>.</p></div></div><div class="code"><div class="wrapper">      &lt;DocumentTitle title=<span class="hljs-string">"Mon historique"</span>&gt;
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">FlatButton</span>
            <span class="hljs-attribute">containerElement</span>=<span class="hljs-value">{&lt;Link</span> <span class="hljs-attribute">to</span>=<span class="hljs-value">"/"</span> /&gt;</span>}
            icon={<span class="hljs-tag">&lt;<span class="hljs-title">ArrowBack</span> /&gt;</span>}
            label="Retour"
          /&gt;
          <span class="hljs-tag">&lt;<span class="hljs-title">Card</span> <span class="hljs-attribute">className</span>=<span class="hljs-value">"history"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">CardTitle</span> <span class="hljs-attribute">title</span>=<span class="hljs-value">"Historique"</span> /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">CardText</span>&gt;</span>
              {history.map((dayStats) =&gt; (</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Pensez bien à toujours définir une association unique et <em>stable</em>
entre l’objet de base et son composant au sein d’un <code>map</code>,
<a href="http://facebook.github.io/react/docs/reconciliation.html#keys">grâce à la propriété <code>key</code></a>.
Sinon, React va s’emmêler les pinceaux quand
le tableau sous-jacent change (suppression, réordonnancement…).</p></div></div><div class="code"><div class="wrapper">                &lt;HistoryDay
                  goals={goals}
                  key={dayStats.date}
                  stats={dayStats}
                /&gt;
              ))}
              {<span class="hljs-comment">// Ici en revanche, on a l’exemple classique du “if”</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p><a href="http://facebook.github.io/react/tips/if-else-in-JSX.html">façon JSX</a> :
une condition suivie d’un et (<code>&amp;&amp;</code>) et du composant.  Si on avait un <code>else</code>
en plus, on préfèrerait un ternaire avec éventuellement des parenthèses
autour de chaque partie si au moins l’une d’elles est multi-lignes.
Voir à ce sujet <a href="http://reactpatterns.com/#conditional-rendering">React Patterns</a>.</p></div></div><div class="code"><div class="wrapper">              history.length === <span class="hljs-number">0</span> &amp;&amp; <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">p</span>&gt;</span>Aucun historique disponible<span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>}
            <span class="hljs-tag">&lt;/<span class="hljs-title">CardText</span>&gt;</span>
            {history.length &gt; 0 &amp;&amp; (
              <span class="hljs-tag">&lt;<span class="hljs-title">CardActions</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">RaisedButton</span>
                  <span class="hljs-attribute">icon</span>=<span class="hljs-value">{&lt;ClearIcon</span> /&gt;</span>}
                  label="Réinitialiser"
                  onClick={() =&gt; dispatch(clearHistory())}
                /&gt;
              <span class="hljs-tag">&lt;/<span class="hljs-title">CardActions</span>&gt;</span>
            )</span>}
          &lt;<span class="hljs-regexp">/Card&gt;
        &lt;/</span>div&gt;
      <span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">DocumentTitle</span>&gt;</span>
    )</span>
  }
}</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h2 id="connexion-au-store-redux">Connexion au <em>store</em> Redux</h2></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>On s’intéresse uniquement aux champs <code>goals</code> et <code>history</code> de l’état global,
qu’on veut retrouver dans nos propriétés sous les mêmes noms.  Par ricochet,
seuls les changements apportés à ces champs entraîneront un éventuel <em>re-render</em>
de notre conteneur.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">const</span> mapStateToProps = ({ goals, history }) =&gt; ({ goals, history })</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>C’est <a href="https://github.com/reactjs/react-redux/blob/master/docs/api.md#connectmapstatetoprops-mapdispatchtoprops-mergeprops-options"><code>connect(…)</code></a>,
fourni par Redux, qui fait les connexions nécessaires pour nous
fournir les propriétés, implémenter notre <code>shouldComponentUpdate(…)</code> et nous fournir
aussi une propriété <code>dispatch(…)</code>, pré-associée au <em>store</em> Redux transmis via le
contexte React.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> connect(mapStateToProps)(HistoryScreen)</div></div></div></div></body></html>