<!DOCTYPE html><html lang="en"><head><title>jest/setup</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="jest/setup"><meta name="groc-project-path" content="jest/setup.js"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path">jest/setup.js</div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><h1 id="configuration-centrale-de-jest-test-par-test">Configuration centrale de Jest, test par test</h1></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Pseudo-polyfill RAF pour virer les warnings, recommandé par React</p></div></div><div class="code"><div class="wrapper">global.requestAnimationFrame = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">callback</span>) </span>{
  setTimeout(callback, <span class="hljs-number">0</span>)
}</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h2 id="enregistrement-des-plugins-chai-gnriques">Enregistrement des plugins Chai génériques</h2></div></div></div><div class="segment"><div class="code"><div class="wrapper"><span class="hljs-keyword">const</span> chai = <span class="hljs-built_in">require</span>(<span class="hljs-string">'chai'</span>)</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>On aime bien faire nos snapshots Jest avec la syntaxe d’assertion Chai…</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">const</span> chaiJestSnapshot = <span class="hljs-built_in">require</span>(<span class="hljs-string">'chai-jest-snapshot'</span>)</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p><a href="http://airbnb.io/enzyme/">Enzyme</a> est la super techno d’Airbnb pour tester
à toute bombe des composants React.  Elle dispose même d’un plugin Chai pour
avoir des assertions plus &quot;métier&quot;.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">const</span> createChaiEnzyme = <span class="hljs-built_in">require</span>(<span class="hljs-string">'chai-enzyme'</span>)</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>On aime bien les diffs JSON de Jest, alors on les restaure pour les assertions
Chai type <code>.deep.equal</code>…</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">const</span> createChaiJestDiff = <span class="hljs-built_in">require</span>(<span class="hljs-string">'chai-jest-diff'</span>).default</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>On s’assure également qu’on peut (et doit, en fait) utiliser toutes les assertions
comme des fonctions, même <code>.undefined</code>, <code>.true</code>, etc. et celles ajoutées par les
plugins (ex. <code>.calledOnce</code>). Ainsi, au lieu d’un échec silencieux en cas de faute
de frappe, on a une erreur franche.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">const</span> dirtyChai = <span class="hljs-built_in">require</span>(<span class="hljs-string">'dirty-chai'</span>)</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>On termine avec des assertions métier sur les <em>spies</em> et <em>stubs</em> Sinon, type
<code>.calledOnce()</code> ou <code>.calledWith(…)</code>.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">const</span> sinonChai = <span class="hljs-built_in">require</span>(<span class="hljs-string">'sinon-chai'</span>)

chai
  .use(chaiJestSnapshot)
  .use(createChaiEnzyme())
  .use(createChaiJestDiff())
  .use(sinonChai)
  .use(dirtyChai)</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Configuration de l’adaptateur Enzyme 3 / React 16</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">const</span> Enzyme = <span class="hljs-built_in">require</span>(<span class="hljs-string">'enzyme'</span>)
<span class="hljs-keyword">const</span> Adapter = <span class="hljs-built_in">require</span>(<span class="hljs-string">'enzyme-adapter-react-16'</span>)

Enzyme.configure({ adapter: <span class="hljs-keyword">new</span> Adapter() })</div></div></div></div></body></html>